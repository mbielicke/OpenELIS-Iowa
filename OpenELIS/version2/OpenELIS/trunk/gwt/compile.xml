<?xml version="1.0" encoding="utf-8" ?>
<project name="OpenELIS" default="gwtc.dev" basedir=".">

	<property name="gwt.sdk" location="/usr/local/java/gwt-2.6.0" />
	
	<property name="jboss.home" location="/usr/local/java/jboss-as-7.1.1.Final"/>
	
	<taskdef name="ivy-configure" classname="org.apache.ivy.ant.IvyConfigure" classpath="/usr/share/java/ivy.jar"/>
	<taskdef name="ivy-resolve" classname="org.apache.ivy.ant.IvyResolve" classpath="/usr/share/java/ivy.jar"/>
	<taskdef name="ivy-retrieve" classname="org.apache.ivy.ant.IvyRetrieve" classpath="/usr/share/java/ivy.jar"/>
	<taskdef name="ivy-deliver" classname="org.apache.ivy.ant.IvyDeliver" classpath="/usr/share/java/ivy.jar"/> 
	<taskdef name="ivy-publish" classname="org.apache.ivy.ant.IvyPublish" classpath="/usr/share/java/ivy.jar"/>
	
	<ivy-configure file="ivysettings.xml"/>
	<ivy-retrieve pattern="lib/[artifact]-[type]-[revision].[ext]"/>
	
	<path id="ivy.lib">
	   <fileset dir="lib" includes="*.jar"/>
    </path>

	<path id="gwt.jars">
		<pathelement location="${gwt.sdk}/gwt-user.jar" />
		<fileset dir="${gwt.sdk}" includes="gwt-dev*.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA-sources.jar" />
    </path>
	
	<path id="jboss.jars">
		<fileset dir="${jboss.home}/bin/client" includes="jboss-client.jar" />
		<fileset dir="${jboss.home}/modules/javax/persistence/api/main" includes="*.jar" />
		<fileset dir="${jboss.home}/modules/javax/annotation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/javax/validation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/picketbox/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/jboss-transaction-spi/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/ejb3/main" includes="*.jar"/>
	</path>
	
	<!--
	<path id="ui.class.path">
		<path refid="gwt.jars"/>
        <fileset dir="../OpenELIS-UI/lib/" includes="*.jar"/>
		<path refid="jboss.jars"/>
    </path>
    -->
	
	<path id="lib.class.path">
		<path refid="gwt.jars"/>
    	<pathelement location="lib/ui.jar"/>
    	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar" />
		<path refid="jboss.jars"/>
	</path>
	
	<path id="security.class.path">
		<path refid="gwt.jars"/>
    	<path refid="ivy.lib"/>
    	<fileset dir="../Security/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
	</path>
	
	<path id="ejb.class.path">
		<path refid="ivy.lib"/>
		<fileset dir="../OpenELIS-EJB/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
	</path>
	
	<path id="gwt.class.path">
		<path refid="gwt.jars"/>
    	<pathelement location="../OpenELIS-Common/bin"/>
    	<pathelement location="../OpenELIS-EJB/bin"/>
    	<pathelement location="../OpenELIS-Lib/bin"/>
		<path refid="jboss.jars"/>
		<path refid="ivy.lib"/>
    	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
	</path>
	
	<path id="common.class.path">
		<path refid="gwt.jars"/>
    	<pathelement location="../OpenELIS-EJB/bin"/>
		<path refid="ivy.lib"/>
    	<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
	</path>	
	
	<path id="web.class.path">
		<path refid="gwt.jars"/>
    	<pathelement location="../OpenELIS-Common/bin"/>
    	<pathelement location="../OpenELIS-EJB/bin"/>
    	<pathelement location="../OpenELIS-Lib/bin"/>
    	<pathelement location="bin"/>
		<path refid="ivy.lib"/>
    	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
	</path>
	
	<path id="gwt.gwtc.path">
		<path refid="gwt.jars"/>
		<pathelement location="src" />
		<pathelement location="../Security/src"/>
		<pathelement location="war/WEB-INF/classes"/>
		<pathelement location="../OpenELIS-Common/src" />
		<pathelement location="../OpenELIS-Common/bin"/>
		<pathelement location="../OpenELIS-Lib/src"/>
		<pathelement location="../OpenELIS-Lib/bin"/>
		<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
		<path refid="ivy.lib"/>
		<path refid="jboss.jars"/>
    </path>
		
	<path id="web.gwtc.path">
		<path refid="gwt.jars"/>
		<pathelement location="../OpenELIS-Web/src"/>
		<pathelement location="../OpenELIS-Web/war/WEB-INF/classes"/>
		<pathelement location="src" />
		<pathelement location="../Security/src"/>
		<pathelement location="../OpenELIS-Common/src" />
		<pathelement location="../OpenELIS-Common/bin"/>
		<pathelement location="lib/ui-jar-1.0.0.jar" />
		<pathelement location="../OpenELIS-Lib/src"/>
		<pathelement location="../OpenELIS-Lib/bin"/>
		<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
		<path refid="ivy.lib"/>
		<path refid="jboss.jars"/>
    </path>

	<target name="javac" depends="clean" description="Compile java source to bytecode">
		<mkdir dir="../OpenELIS-Lib/bin"/>
		<mkdir dir="../Security/bin"/>
		<mkdir dir="../OpenELIS-Common/bin"/>
		<mkdir dir="war/WEB-INF/classes"/>
		<mkdir dir="../OpenELIS-EJB/bin"/>
		<mkdir dir="../OpenELIS-Web/war/WEB-INF/classes"/>
		
		<!-- Projects need to be compiled in the order that they are in until we can remove the manager circular references -->
		
		<!-- Compile of OpenELIS-UI project 
		<javac includeantruntime="false" srcdir="../OpenELIS-UI/src" includes="**" encoding="utf-8" destdir="../OpenELIS-UI/bin" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="ui.class.path"/>
	    </javac>
	    -->
		
		<!-- Compile of OpenELIS-Lib project -->
		<javac executable="/usr/local/java/jdk1.7.0_09/bin/javac" includeantruntime="false" srcdir="../OpenELIS-Lib/src" includes="**" encoding="utf-8" destdir="../OpenELIS-Lib/bin" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
		    <classpath refid="lib.class.path"/>
	    </javac>
		
		<!-- Compile of Security project -->
		<javac includeantruntime="false" srcdir="../Security/shared:../Security/ejb" includes="**" encoding="utf-8" destdir="../Security/bin" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
		    <classpath refid="security.class.path"/>
	    </javac>
		
		<!-- Compile of OpenELIS-EJB -->
		<javac includeantruntime="false" srcdir="../OpenELIS-EJB/src:../OpenELIS-Common/src/org/openelis/domain:../OpenELIS-Common/src/org/openelis/constants:../OpenELIS-Common/src/org/openelis/manager:../OpenELIS-Common/src/org/openelis/utilcommon:../OpenELIS-Common/src/org/openelis/meta:../OpenELIS-Common/src/org/openelis/exception:../OpenELIS-GWT/src/org/openelis/cache:../Security/shared" includes="**" encoding="utf-8" destdir="../OpenELIS-EJB/bin" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="ejb.class.path"/>
	    </javac>
		
		<!-- Compile of OpenELIS-Common -->
		<javac includeantruntime="false" srcdir=":../OpenELIS-Common/src" includes="**" encoding="utf-8" destdir="../OpenELIS-Common/bin" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="common.class.path"/>
	    </javac>
		
		<!-- Compile of OpenELIS-GWT project -->
		<javac includeantruntime="false" srcdir="src" includes="**" encoding="utf-8" destdir="war/WEB-INF/classes" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="gwt.class.path"/> 
	    </javac>
		
		<!-- Compile of OpenELIS-Web project -->
		<javac includeantruntime="false" srcdir="../OpenELIS-Web/src" includes="**" encoding="utf-8" destdir="../OpenELIS-Web/war/WEB-INF/classes" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="web.class.path"/>
	    </javac>
	</target>
	
	<target name="gwtc.dev" depends="javac" description="GWT compile to JavaScript">
		<!-- GWT compile of OpenELIS-GWT project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="gwt.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<jvmarg value="-DOPENELIS=../OpenELIS-GWT/src"/>
			<arg line="-war" />
			<arg value="war" />
			<arg line="-optimize"/>
			<arg value="0"/>
			<arg value="org.openelis.Development" />
		</java>

		<!-- GWT Compile of OpenELIS-Web project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="web.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<arg line="-war" />
			<arg value="war" />
			<arg line="-optimize"/>
			<arg value="0"/>
			<arg value="org.openelis.web.Development"/>
		</java>
	</target>
	
	<target name="gwtc.prod" depends="javac" description="GWT compile to JavaScript">
		<!-- GWT compile of OpenELIS-GWT project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="gwt.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<jvmarg value="-DOPENELIS=../OpenELIS-GWT/src"/>
			<arg line="-war" />
			<arg value="war" />
			<arg value="org.openelis.OpenELIS" />
		</java>

		<!-- GWT Compile of OpenELIS-Web project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="web.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<arg line="-war" />
			<arg value="war" />
			<arg value="org.openelis.web.OpenELISWeb"/>
		</java>
	</target>

	<target name="clean" description="Cleans this project">
		<delete dir="../OpenELIS-Lib/bin" failonerror="false"/>
		<delete dir="../OpenELIS-UI/bin" failonerror="false"/>
		<delete dir="../OpenELIS-Common/bin" failonerror="false"/>
		<delete dir="../OpenELIS-EJB/bin" failonerror="false"/>
		<delete dir="../Security/bin" failonerror="false"/>
		<delete dir="war/WEB-INF/classes" failonerror="false" />
		<delete dir="../OpenELIS-Web/war/WEB-INF/classes" failonerror="false"/>
	</target>

</project>
