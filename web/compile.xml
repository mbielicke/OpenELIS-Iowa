<?xml version="1.0" encoding="utf-8" ?>
<project name="OpenELIS" default="gwtc.dev" basedir=".">

	<property name="gwt.sdk" location="/usr/local/java/gwt-2.6.0" />
	
	<property name="jboss.home" location="/usr/local/java/jboss-as-7.1.1.Final"/>

	<path id="gwt.jars">
		<pathelement location="${gwt.sdk}/gwt-user.jar" />
		<fileset dir="${gwt.sdk}" includes="gwt-dev*.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA-sources.jar" />
    </path>
	
	<path id="jboss.jars">
		<fileset dir="${jboss.home}/bin/client" includes="jboss-client.jar" />
		<fileset dir="${jboss.home}/modules/javax/persistence/api/main" includes="*.jar" />
		<fileset dir="${jboss.home}/modules/javax/annotation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/javax/validation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/picketbox/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/jboss-transaction-spi/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/ejb3/main" includes="*.jar"/>
	</path>
	
	<path id="ui.class.path">
		<path refid="gwt.jars"/>
        <fileset dir="../OpenELIS-UI/lib/" includes="*.jar"/>
		<path refid="jboss.jars"/>
    </path>
		
	<path id="web.class.path">
		<path refid="gwt.jars"/>
		<pathelement location="../OpenELIS-UI/bin"/>
    	<pathelement location="../OpenELIS-Common/bin"/>
    	<pathelement location="../OpenELIS-EJB/bin"/>
    	<pathelement location="../OpenELIS-Lib/bin"/>
    	<pathelement location="bin"/>
    	<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
    	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
	</path>
		
	<path id="web.gwtc.path">
		<path refid="gwt.jars"/>
		<pathelement location="../OpenELIS-GWT/src"/>
		<pathelement location="../OpenELIS-GWT/war/WEB-INF/classes"/>
		<pathelement location="src" />
		<pathelement location="../Security/src"/>
		<pathelement location="../OpenELIS-Common/src" />
		<pathelement location="../OpenELIS-Common/bin"/>
		<pathelement location="../OpenELIS-UI/src" />
		<pathelement location="../OpenELIS-Lib/src"/>
		<pathelement location="../OpenELIS-UI/bin"/>
		<pathelement location="../OpenELIS-Lib/bin"/>
		<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
		<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
		<path refid="jboss.jars"/>
    </path>

	<target name="javac" depends="clean" description="Compile java source to bytecode">
		<mkdir dir="../OpenELIS-Web/war/WEB-INF/classes"/>
		
		<!-- Compile of OpenELIS-Web project -->
		<javac includeantruntime="false" srcdir="../OpenELIS-Web/src" includes="**" encoding="utf-8" destdir="../OpenELIS-Web/war/WEB-INF/classes" source="1.7" target="1.7" nowarn="true" debug="true" debuglevel="lines,vars,source">
            <classpath refid="web.class.path"/>
	    </javac>
	</target>
	
	<target name="gwtc.dev" depends="javac" description="GWT compile to JavaScript">

		<!-- GWT Compile of OpenELIS-Web project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="web.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<arg line="-war" />
			<arg value="war" />
			<arg line="-optimize"/>
			<arg value="0"/>
			<arg value="org.openelis.web.Development"/>
		</java>
	</target>
	
	<target name="gwtc.prod" depends="javac" description="GWT compile to JavaScript">

		<!-- GWT Compile of OpenELIS-Web project -->
		<java failonerror="true" fork="true" classname="com.google.gwt.dev.Compiler">
			<classpath refid="web.gwtc.path"/>
			<jvmarg value="-Xmx2048M" />
			<jvmarg value="-DIMPORT=../OpenELIS-Lib/src/org/openelis/gwt/public/Forms"/>
			<arg line="-war" />
			<arg value="war" />
			<arg value="org.openelis.web.OpenELISWeb"/>
		</java>
	</target>

	<target name="clean" description="Cleans this project">
		<delete dir="../OpenELIS-Web/war/WEB-INF/classes" failonerror="false"/>
	</target>

</project>
