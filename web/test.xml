<?xml version="1.0" encoding="utf-8" ?>
<project xmlns:jacoco="antlib:org.jacoco.ant" name="OpenELIS" default="test.dev" basedir=".">
	<!-- Arguments to gwtc and devmode targets -->
	<property name="gwt.args" value="" />

	<!-- Configure path to GWT SDK -->
	<property name="gwt.sdk" location="/usr/local/java/gwt-2.6.0" />
	<property name="junit.home" location="/usr/local/java/junit"/>
	<property name="checkstyle.home" location="/usr/local/java/checkstyle-5.7" />
	<property name="findbugs.home" location="/usr/local/java/findbugs-2.0.3" />
	<property name="selenium.home" location="/usr/local/java/selenium-2.41.0" />
	<property name="jboss.home" location="/usr/local/java/jboss-as-7.1.1.Final"/>
	
	<taskdef name="findbugs" classpath="${findbugs.home}/lib/findbugs-ant.jar" classname="edu.umd.cs.findbugs.anttask.FindBugsTask" />

	<taskdef uri="antlib:org.jacoco.ant" resource="org/jacoco/ant/antlib.xml">
		<classpath path="/usr/local/java/jacoco/lib/jacocoant.jar"/>
	</taskdef>
	
	<path id="gwt.jars">
		<pathelement location="${gwt.sdk}/gwt-user.jar" />
		<fileset dir="${gwt.sdk}" includes="gwt-dev*.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA.jar" />
		<pathelement location="${gwt.sdk}/validation-api-1.0.0.GA-sources.jar" />
    </path>
	
	<path id="jboss.jars">
		<fileset dir="${jboss.home}/bin/client" includes="jboss-client.jar" />
		<fileset dir="${jboss.home}/modules/javax/persistence/api/main" includes="*.jar" />
		<fileset dir="${jboss.home}/modules/javax/annotation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/javax/validation/api/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/picketbox/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/jboss-transaction-spi/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/jboss/ejb3/main" includes="*.jar"/>
		<fileset dir="${jboss.home}/modules/org/slf4j/main" includes="*.jar"/>
	</path>

	<target name="javac.tests" description="Compiles test code">
		<javac srcdir="test" includes="**" encoding="utf-8" source="1.7" target="1.7" nowarn="true" destdir="war/WEB-INF/classes" debug="true" debuglevel="lines,vars,source">
			<classpath location="${junit.home}/junit-4.11.jar" />
            <classpath>
				<path refid="gwt.jars"/>
            	<pathelement location="../OpenELIS-GWT/war/WEB-INF/classes"/>
        		<pathelement location="../OpenELIS-UI/bin"/>
            	<pathelement location="../OpenELIS-Common/bin"/>
            	<pathelement location="../OpenELIS-EJB/bin"/>
            	<pathelement location="../OpenELIS-Lib/bin"/>
            	<pathelement location="../Security/shared"/>
            	<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
            	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
            	<fileset dir="${selenium.home}/libs/" includes="*.jar" />
            	<fileset dir="${selenium.home}" includes="selenium-java-2.41.0.jar"/>
            	<path refid="jboss.jars"/>
            </classpath>
		</javac>
	</target>

	<target name="test.dev" depends="javac.tests" description="Run development mode tests">
		<delete dir="reports"/>
		<mkdir dir="reports/junit" />
		<jacoco:coverage destfile="reports/jacoco/jacoco.exec">
		<junit includeantruntime="true" fork="yes" showoutput="true" printsummary="withOutAndErr" haltonfailure="no">
			<jvmarg line="-Xmx2048m" />
			<sysproperty key="gwt.args" value="-standardsMode -logLevel WARN" />
			<sysproperty key="java.awt.headless" value="true" />
			<classpath>
				<path refid="gwt.jars"/>
				<pathelement location="src" />
				<pathelement location="test"/>
				<pathelement location="../OpenELIS-GWT/war/WEB-INF/classes"/>
				<pathelement location="../OpenELIS-EJB/src"/>
				<pathelement location="../OpenELIS-EJB/test"/>
				<pathelement location="../Security/shared"/>
				<pathelement location="war/WEB-INF/classes" />
				<pathelement location="${junit.home}/junit-4.11.jar" />
				<fileset dir="${selenium.home}/libs/" includes="*.jar" />
				<fileset dir="${selenium.home}" includes="selenium-java-2.41.0.jar"/>
        		<pathelement location="../OpenELIS-UI/bin"/>
            	<pathelement location="../OpenELIS-Common/bin"/>
            	<pathelement location="../OpenELIS-EJB/bin"/>
            	<pathelement location="../OpenELIS-Lib/bin"/>
            	<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
            	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
				<path refid="jboss.jars"/>
            </classpath>
			<batchtest todir="reports/junit">
				<fileset dir="test">
					<include name="org/openelis/web/modules/**/Test*.java" />
				</fileset>
			</batchtest>
			<formatter type="plain" />
			<formatter type="xml" />
		</junit>
	    </jacoco:coverage>
	</target>

	<target name="acceptance.test.dev" depends="javac.tests" description="Run development mode tests">
		<delete dir="reports"/>
		<mkdir dir="reports/junit" />
		<jacoco:coverage destfile="reports/jacoco/jacoco.exec">
		<junit includeantruntime="true" fork="yes" showoutput="true" printsummary="withOutAndErr" haltonfailure="no">
			<jvmarg line="-Xmx2048m" />
			<sysproperty key="gwt.args" value="-standardsMode -logLevel WARN" />
			<sysproperty key="java.awt.headless" value="true" />
			<classpath>
				<path refid="gwt.jars"/>
				<pathelement location="src" />
				<pathelement location="test"/>
				<pathelement location="../OpenELIS-GWT/src"/>
				<pathelement location="../OpenELIS-EJB/src"/>
				<pathelement location="../OpenELIS-EJB/test"/>
				<pathelement location="../Security/shared"/>
				<pathelement location="war/WEB-INF/classes" />
				<pathelement location="${junit.home}/junit-4.11.jar" />
				<fileset dir="${selenium.home}/libs/" includes="*.jar" />
				<fileset dir="${selenium.home}" includes="selenium-java-2.41.0.jar"/>
				<pathelement location="../OpenELIS-GWT/war/WEB-INF/classes"/>
        		<pathelement location="../OpenELIS-UI/bin"/>
            	<pathelement location="../OpenELIS-Common/bin"/>
            	<pathelement location="../OpenELIS-EJB/bin"/>
            	<pathelement location="../OpenELIS-Lib/bin"/>
            	<fileset dir="../OpenELIS-UI/lib" includes="*.jar"/>
            	<fileset dir="../OpenELIS-Lib/lib" includes="*.jar"/>
				<path refid="jboss.jars"/>
            </classpath>
			<batchtest todir="reports/junit">
				<fileset dir="test">
					<include name="org/openelis/webdriver/**/Test*.java" />
				</fileset>
			</batchtest>
			<formatter type="plain" />
			<formatter type="xml" />
		</junit>
	    </jacoco:coverage>
	</target>



</project>
